<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">


<title data-react-helmet="true">Walk Engine | 歩く aruku</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Walk Engine | 歩く aruku"><meta data-react-helmet="true" name="description" content="## Custom Graph Partition"><meta data-react-helmet="true" property="og:description" content="## Custom Graph Partition"><meta data-react-helmet="true" property="og:url" content="https://pierrenodet.github.io/aruku/aruku/docs/engine">

<link data-react-helmet="true" rel="shortcut icon" href="/aruku/aruku/img/favicon.ico">


<link rel="stylesheet" href="/aruku/styles.c63d07c8.css">


<link rel="preload" href="/aruku/styles.aadef1bf.js" as="script">

<link rel="preload" href="/aruku/runtime~main.9b82d720.js" as="script">

<link rel="preload" href="/aruku/main.6b314d60.js" as="script">

<link rel="preload" href="/aruku/common.2e3f4ce9.js" as="script">

<link rel="preload" href="/aruku/2.51849141.js" as="script">

<link rel="preload" href="/aruku/14.31419152.js" as="script">

<link rel="preload" href="/aruku/5a43d619.fe87a8c7.js" as="script">

<link rel="preload" href="/aruku/17896441.9f67984c.js" as="script">

<link rel="preload" href="/aruku/c0e05d27.fc9bf729.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/aruku/"><strong class="navbar__title">歩く aruku</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/aruku/aruku/api/index.html">API</a><a class="navbar__item navbar__link" href="/aruku/docs/overview">Documentation</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/pierrenodet/aruku" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/aruku/"><strong class="navbar__title">歩く aruku</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/aruku/aruku/api/index.html">API</a></li><li class="menu__list-item"><a class="menu__link" href="/aruku/docs/overview">Documentation</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/pierrenodet/aruku" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/aruku/docs/overview">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/aruku/docs/engine">Walk Engine</a></li><li class="menu__list-item"><a class="menu__link" href="/aruku/docs/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/aruku/docs/transition">Transition Probability</a></li><li class="menu__list-item"><a class="menu__link" href="/aruku/docs/walks">Provided Walks</a></li><li class="menu__list-item"><a class="menu__link" href="/aruku/docs/example">Example</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Walk Engine</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="custom-graph-partition"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-graph-partition" title="Direct link to heading">#</a>Custom Graph Partition</h2><p>One of the bigeast caveats of random walks in distributed environment is the ammount of data exchanged between every steps. Indeed to send a walker to his next vertice, you need to send both the walker (quite small) and a message for second order random walks.</p><p>In spark, message passing is costly as it means shuffling of the data. In order to reduce the shuffling, but keep a high level of parallelism, we need to work not at the partition level but at the executor level.</p><p>So inspired by the talk of Min Shen at Spark Summit 2017, a custom graph partition is implemented, being an adjancy list shared at the executor level. When sending a worker to his next step, we only need to shuffle the data if the next vertice is not in the same executor instead of being in a different partition. Thus reducing the amount of shuffled data.</p><p><strong>aruku is distributed, but not out of core</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="routing-table"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#routing-table" title="Direct link to heading">#</a>Routing Table</h2><p>With this custom graph partition we have actually lost a lot of cool features provided by GraphX to store distributed graph, especially fault tolerance and the automatic distributed message passing.</p><p>In order to get the automatic distributed message passing, as we store the graph in our custom parititons, we are going to use a predefined partitioner. As the RDD is keyed with the vertex id, if we want to send the walker to the right parition containing his next vertex, we just need to keyed the RDD of walkers with the next vertex id and repartition them by our predefined partitioner.</p><p>To get the fault tolerance back, instead of just repartitioning our RDD of walkers keyed by the vertex id they need to be send to, we are going to zipPartition this RDD to our routing table which is the empty RDD that is the result of storing our input RDD into our custom graph partitions. If we lose an executor we will need to recompute this RDD and fill the custom graph partition in the new executor spawned by SparK.</p><p><strong>aruku is fault tolerant</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="optimized-edge-sampling"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#optimized-edge-sampling" title="Direct link to heading">#</a>Optimized Edge Sampling</h2><p>Another difficult part of implementing efficient higher order random walks for big graphs is having an efficient edge sampling. Indeed if the alias sampling works well to precompute sampling for the transition probabilities, it&#x27;s only suited for static walks. For dynamic walks the number of possiblities is too huge to precompute thus having clever algorithm is required.</p><p>KnightKing [<a aria-current="page" class="active" href="/aruku/docs/engine#https://github.com/KnightKingWalk/KnightKing">github</a>] is a general-purpose, distributed graph random walk engine that proposed a number of optimizations to random walks. One of them is an optimized rejection sampling in order to do edge sampling efficiently.</p><p>They decomposed the transition probability in a static and dynamic componenent. For the dynamic sampling they compare it to throwing a dart in a target, with bars of width of the static component and height of the dynamic one. The static componenent is dealt with alias sampling. The dynamic is using rejection sampling and clever optimizations with lower bound bypass and clever folding.</p><p><strong>aruku is fast, but probably slower than KnightKing</strong></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/pierrenodet/aruku/edit/master/../modules/aruku-docs/target/mdoc/engine.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/aruku/docs/overview"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/aruku/docs/configuration"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Configuration »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#custom-graph-partition" class="contents__link">Custom Graph Partition</a></li><li><a href="#routing-table" class="contents__link">Routing Table</a></li><li><a href="#optimized-edge-sampling" class="contents__link">Optimized Edge Sampling</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright © 2020 Pierre Nodet</div></div></div></footer>
</div>

<script src="/aruku/styles.aadef1bf.js"></script>

<script src="/aruku/runtime~main.9b82d720.js"></script>

<script src="/aruku/main.6b314d60.js"></script>

<script src="/aruku/common.2e3f4ce9.js"></script>

<script src="/aruku/2.51849141.js"></script>

<script src="/aruku/14.31419152.js"></script>

<script src="/aruku/5a43d619.fe87a8c7.js"></script>

<script src="/aruku/17896441.9f67984c.js"></script>

<script src="/aruku/c0e05d27.fc9bf729.js"></script>


</body>
</html>